<div id='his'>
<input type="radio" name='history' id='history_trace'>查询历史轨迹</input>
<input type="radio" name='history' id="history_post">查询历史发布信息</input>
</div>
<div>
<input type="button" id="trace" name="trace" value="查询历史轨迹" />
<input type="button" id="his_info" name="his_info" value="查询发布历史"></input>
开始时间:
<input type="text" id="inquire_startTime" size="30" />
&nbsp;&nbsp;&nbsp; 结束时间:
<input type="text" id="inquire_endTime" size="30" />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span id='info_select_vehicle'>选择车辆：</span>
<select id="vehicle_info">
{{vehicle_list}}
</select>

</div>
<div id='his_infoes'>
<table id='infoes'></table>
<div id="pagernav_infoes"></div>
</div>
<script type="text/javascript">
  
    if($("#vehicle_info option:selected").attr("name")=="have"){
		$("#his").hide();
        }
	$("#his_info").hide();
	$("#history_trace").attr("checked","checked");
	var myDate = new Date();
	$("#inquire_startTime").val(getTodayFormatDate());
	$("#inquire_endTime").val(getNowFormatDate());


function kobe(){
	alert(44);
}
	
$("#history_post").click(function(){
	$("#vehicle_info").hide();
	$("#info_select_vehicle").hide();
	$("#trace").hide();
	$("#his_info").show();
});
$("#history_trace").click(function(){
	$("#his_info").hide();
	$("#info_select_vehicle").show();
	$("#vehicle_info").show();
	$("#trace").show();
});

//获取系统当前时间并格式化为yyyy/mm/dd hh:mm:ss
function getNowFormatDate()
{
   	var day = new Date();

   	var Year = 0;
   	var Month = 0;
   	var Day = 0;
	var CurrentDate = "";
   //初始化时间
   	Year= day.getFullYear();
   	Month= day.getMonth()+1;
   	Day = day.getDate();
   	Hour = day.getHours();
 	Minute = day.getMinutes();
	Second = day.getSeconds();
   	CurrentDate += Year + "/";
   	if (Month >= 10){
    	CurrentDate += Month + "/";
   	}else{
    	CurrentDate += "0" + Month + "/";
   	}
   	if (Day >= 10 ){
    	CurrentDate += Day +" ";
   	}else{
    	CurrentDate += "0" + Day+" " ;
   	}
   	if(Hour>=10){
		CurrentDate+=Hour+":";
	}else{
		CurrentDate+="0"+Hour+":";
   	}if (Minute >= 10 ){
    	CurrentDate += Minute +":";
   	}else{
    	CurrentDate += "0" + Minute+":" ;
   	}
   	if(Second>=10){
		CurrentDate+=Second;
	}else{
		CurrentDate+="0"+Second;
   	}
   	return CurrentDate;
}

	//获取系统当天零点时间并格式化为yyyy/mm/dd hh:mm:ss
	function getTodayFormatDate()
	{
	   	var day = new Date();
	
	   	var Year = 0;
	   	var Month = 0;
	   	var Day = 0;
		var CurrentDate = "";
	   //初始化时间
	   	Year= day.getFullYear();
	   	Month= day.getMonth()+1;
	   	Day = day.getDate();
	   	CurrentDate += Year + "/";
	   	if (Month >= 10){
	    	CurrentDate += Month + "/";
	   	}else{
	    	CurrentDate += "0" + Month + "/";
	   	}
	   	if (Day >= 10 ){
	    	CurrentDate += Day +" ";
	   	}else{
	    	CurrentDate += "0" + Day+" " ;
	   	}
	   	CurrentDate+="00:00:00";
	   	return CurrentDate;
	}

	
			$("#trace").click(function(){ 
				
				var startTime = $("#inquire_startTime").attr("value");
				 
				if(startTime == ""){
					alert("开始时间不能为空!");
					$("#startTime").focus();
					return false;
				}
				var endTime = $("#inquire_endTime").attr("value");
				if(endTime == ""){
					alert("结束时间不能为空!");
					$("#endTime").focus();
					return false;
				}
				arr_history = getHourList(); 
				clearOverLay();
				vehicle_id = $("#vehicle_info option:selected").val();
				runHistoryTrack();
				closeDialog();
			});


			$("#his_info").click(function(){
				var startTime = $("#inquire_startTime").attr("value");
				 
				if(startTime == ""){
					alert("开始时间不能为空!");
					$("#inquire_startTime").focus();
					return false;
				}
				var endTime = $("#inquire_endTime").attr("value");
				if(endTime == ""){
					alert("结束时间不能为空!");
					$("#inquire_endTime").focus();
					return false;
				}

				jQuery("#infoes").jqGrid({
					url:'index.php?a=354&begin_date='+$("#inquire_startTime").val()+'&end_date='+$("#inquire_endTime").val(),
					  datatype: "json",
				   	colNames:['ID','发布人', '类型', '发布时间','生效时间','失效时间','信息内容'],
				   	colModel:[
				   		{name:'id',index:'id', width:55,editable:false,hidden:true,editoptions:{readonly:true,size:10}},
				   		{name:'issuer_id',index:'issuer_id', width:80},
				   		{name:'type',index:'type', width:70},
				   		{name:'issue_time',index:'issue_time', width:140, align:"left"},   
				   		{name:'begin_time',index:'begin_time', width:140, align:"left"},
				   		{name:'end_time',index:'end_time', width:140, align:"left"},
				   		{name:'content',index:'content', width:900, align:"left"}
				   		
				   	],
				   	rowNum:10,
				   	rowList:[10,20,30],
				   	pager: '#pagernav_infoes',
				   	sortname: 'id',
				    viewrecords: true,
				    sortorder: "desc",
				    caption:"历史信息",
					height:290
				});

				jQuery("#infoes").jqGrid('navGrid_infoes','#pagernav_infoes',
				{edit:false,add:false,del:false});
				
			});


		$("#inquire_startTime").datetimepicker({
			 ampm: false,//上午下午是否显示  
			 timeFormat: 'hh:mm:ss',//时间模式  
			 stepHour: 1,//拖动时间时的间隔  
			 dateFormat:"yy/mm/dd", //日期格式设定  
			 showHour: true,//是否显示小时，默认是true  
			 showMinute:false,
			 showSecond:false,
			 createButton:false
		 });	
	     

		$("#inquire_endTime").datetimepicker({
			 ampm: false,//上午下午是否显示  
			 timeFormat: 'hh:mm:ss',//时间模式  
			 stepHour: 1,//拖动时间时的间隔  
			 dateFormat:"yy/mm/dd", //日期格式设定  
			 showHour: true,//是否显示小时，默认是true  
			 showMinute:false,
			 showSecond:false,
			 createButton:false
		 });

		function getHourList(){
			var startTime = $("#inquire_startTime").attr("value");
			var endTime = $("#inquire_endTime").attr("value");

			var startdt0 = new Date(Date.parse(startTime));
			var enddt0 = new Date(Date.parse(endTime));

			startdt = startdt0.getTime();
			enddt = enddt0.getTime();

			var hourList = new Array();
			
			while(startdt <  enddt){
				var date = new Date();
				date.setTime(startdt);

				var hourStr = date.getFullYear() + "" + padLeft("" + (date.getMonth()+1),2) + "" + date.getDate() + "" + padLeft("" + date.getHours(),2);
				hourList.push(hourStr);
				
				//startdt += 60*60*1000; //起始时间增加1小时
				startdt += 30*60*1000; //起始时间增加半小时
			}
			
			return hourList;
		}

		function padLeft(str,lenght){ 
			if(str.length >= lenght){
				return str;
			}
			else{ 
				return padLeft("0" +str,lenght); 
			}
		} 
</script>
