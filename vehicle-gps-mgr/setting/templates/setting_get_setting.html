<style>
html,body {
	margin: 0; /* Remove body margin/padding */
	padding: 0;
	overflow: hidden; /* Remove scroll bars on browser window */
	font-size: 85%;
}
</style>


<div
	style="border: 2px gray solid; width: 400px; height: 300px; text-align: cneter; padding: 5px 30px 5px 30px; margin-top: 20px;">
<!-- 超速限制 -->
<div style="width: 360px; height: 22px; margin-top: 10px;">
<div style="width: 120px; height: 21px; float: left; text-align: right;">超速限制：</div>
<div style="width: 160px; height: 21px; float: left; margin-left: 13px;">
<input type='text' name='speed_limit' id='speed_limit'
	value='{{speed_limit}}'></div>
<div style="width: 50px; height: 21px; float: left;">公里/h</div>
</div>


<!-- 疲劳驾驶限制 -->
<div style="width: 360px; height: 22px; margin-top: 10px;">
<div style="width: 120px; height: 21px; float: left; text-align: right;">疲劳驾驶限制：</div>
<div style="width: 160px; height: 21px; float: left; margin-left: 13px;">
<input type='text' name='fatigue_remind_time' id='fatigue_remind_time'
	value='{{fatigue_remind_time}}'></div>
<div style="width: 50px; height: 21px; float: left;">小时</div>
</div>

<!-- 刷新时间 -->
<div style="width: 300px; height: 22px; margin-top: 10px;">
<div style="width: 120px; height: 21px; float: left; text-align: right;">刷新时间：</div>
<div style="width: 120px; height: 21px; float: left; margin-left: 13px;">{{page_refresh_time}}</div>
</div>

<!-- 默认颜色 -->
<div style="width: 300px; height: 30px; margin-top: 10px;">
<div
	style="width: 120px; height: 22px; float: left; text-align: right; margin-top: 5px;">默认轨迹颜色：</div>
<div style="width: 120px; height: 29px; float: left; margin-left: 13px;">{{default_color}}</div>
</div>

<!-- 速度颜色映射设置 -->
<div style="width: 400px; height: 75px; margin-top: 10px;">
<div
	style="width: 120px; height: 33px; float: left; text-align: right; margin-top: 20px;">速度颜色映射设置
:</div>
<div style="width: 200px; height: 74px; float: left; margin-left: 13px;">
<div id='speeds'>{{speeds}}</div>
</div>
<div style="width: 50px; height: 33px; float: left; margin-top: 20px;">
<a href='javascript:void(0);' onclick='adviceDialog();'>设置</a></div>
</div>

<!-- 修改按钮 -->
<div
	style="width: 80px; height: 30px; margin: 30px auto; text-align: center;">
<input type="submit" value="确认修改" onclick="update_set();" /></div>



<!-- 弹出设置颜色的模式窗口 -->
<div style="padding: 20px; background-color: #fff; display: none;"
	id="color_mapping_dialog">
<div id="canAdviceSelectDiv"></div>
</div>
</div>

<SCRIPT LANGUAGE="JavaScript">
<!--
//速度时间映射
function adviceDialog(){
      jQuery("#color_mapping_dialog").dialog({
			bgiframe: true,
			autoOpen: true, 
			height: 300, 
			width: 300,
			modal: true,
			title: '速度颜色映射设置',
			buttons: {
			    '取消': function() {
					jQuery(this).dialog('close');
			  },'提交': function() { 
					
					var str="";//循环取出所有已经有的数
					var str_color="";//循环取出
					for(var i=0;i<8;i++)
					{    					
					//取出每个颜色的默认
						var d_color = document.getElementById("hi_color_p_"+i).value;
					//取出最小值 和 最大值
						var min = document.getElementById("speed_"+2*i).value;
						var max = document.getElementById("speed_"+(parseInt(2*i)+parseInt(1))).value;
						str += min+"_"+max+"_"+d_color+"|";

                    //取出所选的车辆颜色信息
						if(min!=""&&max!=""){
	 	                     	str_color=str_color+d_color+","
	 	                  }
	 				 }
					 
                  //判断是否有重复的颜色            
                  var repeat=false;                
					  var color_array=str_color.split(",");
					  var compare=str_color.split(",");
						
	                  for(var i=0;i<color_array.length-1;i++){
	                	  if(repeat){
			                  break;
		                  }
	                	   compare.splice(i,1);
		                  for(var a=0;a<compare.length-1;a++){			           			              
	                	    if(color_array[i]==compare[a])
	                	    {		              	                	              	
	                	      repeat=true;
	                	      break;	 
	                	    }            	                  	    
		                  }	
		                  var compare=str_color.split(",");		                  
	                  }

	                  
		            if(repeat){
			            alert("不能选择相同颜色的车辆");
			            return;			            
		            }else{
		            	$.ajax({
							type: "POST",
							url: "index.php?a=5019&part=2",
							data: "parm="+str,
							success: function(msg){
								 //刷新页面中的数据
							$.ajax({										
										type: "POST",
										url: "index.php?a=5020",
										data: "",
										success: function(msg){
										jQuery("#speeds").html(msg); 
								   }
							  });
							}
					   });
		            }    
					//关闭
					jQuery(this).dialog('close');
				}
        },open:function(event,ui){

		        getTraffic();
        }
	 });
   
}

function getTraffic()
{
	$.ajax({
		type: "POST",
		url: "index.php?a=5018",
		data: "",
		success: function(msg){
			 jQuery("#canAdviceSelectDiv").html(msg); 
		}
	 });
}

function update_set(){

	//取得各种值

	//刷新时间
	var page_refresh_time = document.getElementById("page_refresh_time").value;

	//速度限制
	var speed_limit = document.getElementById("speed_limit").value;

	//疲劳限制
	var fatigue_remind_time = document.getElementById("fatigue_remind_time").value;

	//默认颜色
	var de_color = document.getElementById("hi_color_l").value;

	$.ajax({
		type: "POST",
		url: "index.php?a=5019&part=1",
		data: "page_refresh_time="+page_refresh_time+"&default_color="+de_color+"&speed_limit="+speed_limit+"&fatigue_remind_time="+fatigue_remind_time,
		success: function(msg){
			alert("配置更新成功！");
			
			$.post("index.php",{
				 "a":5021}
				,function(data){
					
					var array=data.split("|");
					if(array.length==0){
						$("#header").unmask();
						alert("没有数据");
					}else
					{    
						var image="";
						for(var i=0;i<array.length-1;i++){
							var data_list_min=array[i].split(",");
							image=image+"<div style='float:left;heigth:17px;'>" +
									    "&nbsp;&nbsp;&nbsp;<img src="+data_list_min[0]+" style='height:17px;'/>&nbsp;" 
									    +data_list_min[1]+"-"+data_list_min[2]+"</div>";
						}		
						$("#header").unmask();
						$("#carInfor").html(image);
				    }
				});
		}
	 });

}

//当前最小值是第2行的最大值
function change_speed(obj)
{
	var ss;
	//当前文本框ID
	var speed_id = obj.id;

	var speed_value = $("#"+speed_id).attr("value");

	ss = speed_id.split("_");

	$("#speed_"+(parseInt(ss[1])+parseInt(1))).attr("value",speed_value);

	//检查最大值一定比最小值大	
	var max_v = $("#speed_"+(parseInt(ss[1])-parseInt(1))).attr("value");

	if(max_v >= speed_value && speed_value != "")
		alert("最大速度应大于最小速度");
}

//-->
</SCRIPT>