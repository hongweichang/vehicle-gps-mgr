<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<link href="css/select.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" type="text/css" media="screen" href="css/redmond/jquery-ui-1.8.1.custom.css" /> 
	
	<script language="javascript" src="js/jquery-1.4.2.js" ></script>
	<script src="js/jquery-ui-1.8.1.custom.min.js" type="text/javascript"></script>
	<script src="js/select.js" language="javascript"></script>

	<style>
		html, body {
			margin: 0;			/* Remove body margin/padding */
			padding: 0;
			overflow: hidden;	/* Remove scroll bars on browser window */	
		    font-size: 85%;
		}
	</style>
</head>
<body style=" width:99%; height:99%;">
	<div style="border:2px gray solid; width:400px; height:300px; text-align:cneter;padding:5px 30px 5px 30px; margin-top:20px;">
	<!-- 超速限制 -->
		<div style="width:360px; height:22px; margin-top:10px;">
			<div style="width:120px; height:21px; float:left; text-align:right;">超速限制：</div>
			<div style="width:160px; height:21px; float:left;margin-left:13px;">
				<input type='text' name = 'speed_limit' id = 'speed_limit' value='{{speed_limit}}'>
			</div>
			<div style="width:50px; height:21px; float:left;">公里/h</div>
		</div>
		 
	
		<!-- 疲劳驾驶限制 -->
		<div style=" width:360px; height:22px;margin-top:10px;">
			<div style="width:120px; height:21px; float:left; text-align:right;">疲劳驾驶限制：</div>
			<div style="width:160px; height:21px; float:left;margin-left:13px;">
				<input type='text' name = 'fatigue_remind_time' id = 'fatigue_remind_time' value='{{fatigue_remind_time}}'>
			</div>
			<div style="width:50px; height:21px; float:left;"> 小时</div>
		</div>
		
		<!-- 刷新时间 -->
		<div style="width:300px; height:22px;margin-top:10px;">
			<div style="width:120px; height:21px; float:left; text-align:right;">刷新时间：</div>
			<div style="width:120px; height:21px; float:left;margin-left:13px;">{{page_refresh_time}}</div>
		</div>
		
		<!-- 默认颜色 -->
		<div style="width:300px; height:30px;margin-top:10px;">
			<div style="width:120px; height:22px; float:left; text-align:right; margin-top:5px;">默认轨迹颜色：</div>
			<div style="width:120px; height:29px; float:left;margin-left:13px;">{{default_color}}</div>
		</div>
		
			<!-- 速度颜色映射设置 -->
		<div style="width:400px; height:75px;margin-top:10px;">
			<div style="width:120px; height:33px; float:left; text-align:right;margin-top:20px;">速度颜色映射设置 :</div>
			<div style="width:200px; height:74px; float:left;margin-left:13px;">
				<div id='speeds'>{{speeds}}</div>
			</div>
			<div style="width:50px; height:33px; float:left;margin-top:20px;">
				<a href='javascript:void(0);' onclick='adviceDialog();'>设置</a>
			</div>
		</div>
		
		<!-- 修改按钮 -->
		<div style="width:80px; height:30px; margin:30px auto; text-align:center;">
			<input type="submit" value="确认修改" onclick="update_set();"/>
		</div>
		
		
		
		<!-- 弹出设置颜色的模式窗口 -->
		<div style="padding: 20px; background-color: #fff; display: none" id="dialog">
				<div id="canAdviceSelectDiv"></div>
		</div>
	</div>
</body>
</html>
<SCRIPT LANGUAGE="JavaScript">
<!--
	//速度时间映射
function adviceDialog(){
    jQuery("#dialog").dialog({
			bgiframe: true,
			autoOpen: true, 
			height: 400, 
			width: 500,
			modal: true,
			title: '速度颜色映射设置',
			buttons: {
			    '取消': function() {
					jQuery(this).dialog('close');
			  },'提交': function() { 
					
					//查询一共有多少行
//					var count = document.getElementById("c_hidden").value;

					//循环取出所有已经有的数据
					var str="";
					for(var i=0;i<8;i++)
					{
						//取出每个颜色的默认
						var d_color = document.getElementById("hi_color_p_"+i).value;

						//取出最小值 和 最大值
						var min = document.getElementById("speed_"+2*i).value;

						var max = document.getElementById("speed_"+(parseInt(2*i)+parseInt(1))).value;

						str += min+"_"+max+"_"+d_color+"|";
					}
//alert(str);
					$.ajax({
						type: "POST",
						url: "index.php?a=5019&part=2",
						data: "parm="+str,
						success: function(msg){
							alert(msg);

							 //刷新页面中的数据
							$.ajax({
									type: "POST",
									url: "index.php?a=5020",
									data: "",
									success: function(msg){
										 jQuery("#speeds").html(msg); 
									}
								 });
						}
					 });


					//关闭
					jQuery(this).dialog('close');

				}
            },open:function(event,ui){

		        getTraffic();
            }
	 });
}

function getTraffic()
{
//	alert(driver_id+"===="+company_id);
	$.ajax({
		type: "POST",
		url: "index.php?a=5018",
		data: "",
		success: function(msg){
			 jQuery("#canAdviceSelectDiv").html(msg); 
		}
	 });
}

function update_set(){

	//取得各种值

	//刷新时间
	var page_refresh_time = document.getElementById("page_refresh_time").value;

	//速度限制
	var speed_limit = document.getElementById("speed_limit").value;

	//疲劳限制
	var fatigue_remind_time = document.getElementById("fatigue_remind_time").value;

	//默认颜色
	var de_color = document.getElementById("hi_color_l").value;

//	alert(page_refresh_time+"=="+speed_limit+"=="+fatigue_remind_time+"=="+de_color);

	$.ajax({
		type: "POST",
		url: "index.php?a=5019&part=1",
		data: "page_refresh_time="+page_refresh_time+"&default_color="+de_color+"&speed_limit="+speed_limit+"&fatigue_remind_time="+fatigue_remind_time,
		success: function(msg){
			alert("配置更新成功！");
		}
	 });

}

//当前最小值是第2行的最大值
function change_speed(obj)
{
	var ss;
	//当前文本框ID
	var speed_id = obj.id;

	var speed_value = $("#"+speed_id).attr("value");

	ss = speed_id.split("_");

	$("#speed_"+(parseInt(ss[1])+parseInt(1))).attr("value",speed_value);

	//检查最大值一定比最小值大	
	var max_v = $("#speed_"+(parseInt(ss[1])-parseInt(1))).attr("value");

	if(max_v >= speed_value && speed_value != "")
		alert("最大速度应大于最小速度");
}

//-->
</SCRIPT>