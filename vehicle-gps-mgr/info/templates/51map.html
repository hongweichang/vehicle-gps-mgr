<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>定位</title>
<script language="javascript" src="http://api.51ditu.com/js/maps.js"></script>
<script language="javascript" src="/js/jquery-1.4.2.js" ></script>
</head>
<body>
<div id="myMap" style="position:relative; width:100%; height:115%;"></div>

<script language="javascript">
var ifr = window.parent.document.getElementById("locate");

var maps = new LTMaps( "myMap" );
/*
var lon_lat = window.parent.document.getElementsByName('lonlat');
var points = new Array();
for(var i = 0 ; i <lon_lat.length;i++){
	points.push(new LTPoint(lon_lat[i].title,lon_lat[i].value));
}

maps.getBestMap( points );

for(var i=0 ; i<points.length ; i++)
{
var marker = new LTMarker( points[i] );
maps.addOverLay( marker );
}*/
maps.cityNameAndZoom( "beijing" , 12 ); 


maps.addControl(new LTSmallMapControl());
if(ifr==null){
control = new LTZoomSearchControl();
control.setTop(10);
control.setLabel("选中矩形区域查询");
maps.addControl( control );

//选中区域
LTEvent.addListener(control,"mouseup",drawRectangle);

var over_lay;

//手动画矩形
function drawRectangle(){

	maps.removeOverLay(over_lay,false);
	//矩形地理区域的对象
	var drawBounds = control.getBoundsLatLng();
	
	var lonMin = drawBounds.getXmin();//最小经度
	var latMin = drawBounds.getYmin();//最小纬度
	var lonMax = drawBounds.getXmax();//最大经度
	var latMax = drawBounds.getYmax();//最大纬度
	
	
	//生成矩形地理区域
	var rectangleBounds =new LTBounds(lonMin,latMin,lonMax,latMax);
	
	//在地图画出矩形图 
	over_lay = new LTRect(rectangleBounds);
	maps.addOverLay(over_lay);
	
	document.getElementById("lonMin").value=lonMin;
	document.getElementById("latMin").value=latMin;
	document.getElementById("lonMax").value=lonMax;
	document.getElementById("latMax").value=latMax;
	}
}
/**
 * 清除所有标点，重新加载新数据
 */
function clearOverLay(){
	maps.clearOverLays(); 
}

/**
 * 车辆请求定位
 * @param {Object} str 车辆ID集合 格式"ID1,ID2,ID3,"
 */

function location(ids){  	 
	 $.ajax({
			type:"POST",
			url:window.parent.host+"/index.php?a=2&vehicleIds="+ids, 
			dataType:"json",
			success:function(data){ 			 
				var length = data.length; 
				var points = new Array();
				 
				if(length>0)clearOverLay();

				for(var i=0;i<length;i++){        					
					var point_longitude = data[i][1]; //点经度
					var point_latitude =  data[i][2]; //点纬度
					var number_plate = data[i][5]; //车牌号
					var file_path = data[i][4]; //文件目录
					var img_name = data[i][3];  //图片名称				

					points.push( new LTPoint(point_longitude,point_latitude));

					//创建点对象
					var marker = new LTMarker(new LTPoint(point_longitude,point_latitude),
									 	  new LTIcon(window.parent.host+"/"+file_path+"/"+img_name+".png"));

					//点对象设置内容
					var context = "车牌号："+number_plate;
					//点对象设置内容
					addInfoWin(marker,context);

					//点添入地图中
					maps.addOverLay(marker);
					
					var text = new LTMapText( new LTPoint(point_longitude,point_latitude ) );
					text.setLabel(number_plate ); 
					maps.addOverLay( text ); 
				}
				maps.getBestMap(points);
			 }
			});

 }
/**
 * 车辆提示信息
 * @param {Object} obj  点对象
 * @param {Object} context 对象提示内容
 */
function addInfoWin(obj,context){
	
	var info = new LTInfoWindow( obj );

	function shwoInfo(){
		info.setLabel(context);
		info.clear();
		maps.addOverLay(info);
	}
	LTEvent.addListener(obj,"click",shwoInfo); 
} 

</script>

<div id='lat_long'>
   <input type="hidden" id='lonMin'></input>
   <input type='hidden' id='latMin'></input>
   <input type='hidden' id='lonMax'></input>
   <input type='hidden' id='latMax'></input>
</div>
</body>
</html>